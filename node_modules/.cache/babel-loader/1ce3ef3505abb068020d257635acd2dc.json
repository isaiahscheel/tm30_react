{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar Drawing = require('../../components/drawing');\n\nvar heatmapStyle = require('../heatmap/style');\n\nvar makeColorMap = require('./make_color_map');\n\nmodule.exports = function style(gd) {\n  var contours = d3.select(gd).selectAll('g.contour');\n  contours.style('opacity', function (d) {\n    return d[0].trace.opacity;\n  });\n  contours.each(function (d) {\n    var c = d3.select(this);\n    var trace = d[0].trace;\n    var contours = trace.contours;\n    var line = trace.line;\n    var cs = contours.size || 1;\n    var start = contours.start; // for contourcarpet only - is this a constraint-type contour trace?\n\n    var isConstraintType = contours.type === 'constraint';\n    var colorLines = !isConstraintType && contours.coloring === 'lines';\n    var colorFills = !isConstraintType && contours.coloring === 'fill';\n    var colorMap = colorLines || colorFills ? makeColorMap(trace) : null;\n    c.selectAll('g.contourlevel').each(function (d) {\n      d3.select(this).selectAll('path').call(Drawing.lineGroupStyle, line.width, colorLines ? colorMap(d.level) : line.color, line.dash);\n    });\n    var labelFont = contours.labelfont;\n    c.selectAll('g.contourlabels text').each(function (d) {\n      Drawing.font(d3.select(this), {\n        family: labelFont.family,\n        size: labelFont.size,\n        color: labelFont.color || (colorLines ? colorMap(d.level) : line.color)\n      });\n    });\n\n    if (isConstraintType) {\n      c.selectAll('g.contourfill path').style('fill', trace.fillcolor);\n    } else if (colorFills) {\n      var firstFill;\n      c.selectAll('g.contourfill path').style('fill', function (d) {\n        if (firstFill === undefined) firstFill = d.level;\n        return colorMap(d.level + 0.5 * cs);\n      });\n      if (firstFill === undefined) firstFill = start;\n      c.selectAll('g.contourbg path').style('fill', colorMap(firstFill - 0.5 * cs));\n    }\n  });\n  heatmapStyle(gd);\n};","map":null,"metadata":{},"sourceType":"script"}