{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar getSubplotCalcData = require('../get_data').getSubplotCalcData;\n\nvar counterRegex = require('../../lib').counterRegex;\n\nvar createPolar = require('./polar');\n\nvar constants = require('./constants');\n\nvar attr = constants.attr;\nvar name = constants.name;\nvar counter = counterRegex(name);\nvar attributes = {};\nattributes[attr] = {\n  valType: 'subplotid',\n  role: 'info',\n  dflt: name,\n  editType: 'calc',\n  description: ['Sets a reference between this trace\\'s data coordinates and', 'a polar subplot.', 'If *polar* (the default value), the data refer to `layout.polar`.', 'If *polar2*, the data refer to `layout.polar2`, and so on.'].join(' ')\n};\n\nfunction plot(gd) {\n  var fullLayout = gd._fullLayout;\n  var calcData = gd.calcdata;\n  var subplotIds = fullLayout._subplots[name];\n\n  for (var i = 0; i < subplotIds.length; i++) {\n    var id = subplotIds[i];\n    var subplotCalcData = getSubplotCalcData(calcData, name, id);\n    var subplot = fullLayout[id]._subplot;\n\n    if (!subplot) {\n      subplot = createPolar(gd, id);\n      fullLayout[id]._subplot = subplot;\n    }\n\n    subplot.plot(subplotCalcData, fullLayout, gd._promises);\n  }\n}\n\nfunction clean(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n  var oldIds = oldFullLayout._subplots[name] || [];\n\n  var hadGl = oldFullLayout._has && oldFullLayout._has('gl');\n\n  var hasGl = newFullLayout._has && newFullLayout._has('gl');\n\n  var mustCleanScene = hadGl && !hasGl;\n\n  for (var i = 0; i < oldIds.length; i++) {\n    var id = oldIds[i];\n    var oldSubplot = oldFullLayout[id]._subplot;\n\n    if (!newFullLayout[id] && !!oldSubplot) {\n      oldSubplot.framework.remove();\n      oldSubplot.layers['radial-axis-title'].remove();\n\n      for (var k in oldSubplot.clipPaths) {\n        oldSubplot.clipPaths[k].remove();\n      }\n    }\n\n    if (mustCleanScene && oldSubplot._scene) {\n      oldSubplot._scene.destroy();\n\n      oldSubplot._scene = null;\n    }\n  }\n}\n\nmodule.exports = {\n  attr: attr,\n  name: name,\n  idRoot: name,\n  idRegex: counter,\n  attrRegex: counter,\n  attributes: attributes,\n  layoutAttributes: require('./layout_attributes'),\n  supplyLayoutDefaults: require('./layout_defaults'),\n  plot: plot,\n  clean: clean,\n  toSVG: require('../cartesian').toSVG\n};","map":null,"metadata":{},"sourceType":"script"}