{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar Colorscale = require('../../components/colorscale');\n\nvar heatmapCalc = require('../heatmap/calc');\n\nvar setContours = require('./set_contours');\n\nvar endPlus = require('./end_plus'); // most is the same as heatmap calc, then adjust it\n// though a few things inside heatmap calc still look for\n// contour maps, because the makeBoundArray calls are too entangled\n\n\nmodule.exports = function calc(gd, trace) {\n  var cd = heatmapCalc(gd, trace);\n  var zOut = cd[0].z;\n  setContours(trace, zOut);\n  var contours = trace.contours;\n  var cOpts = Colorscale.extractOpts(trace);\n  var cVals;\n\n  if (contours.coloring === 'heatmap' && cOpts.auto && trace.autocontour === false) {\n    var start = contours.start;\n    var end = endPlus(contours);\n    var cs = contours.size || 1;\n    var nc = Math.floor((end - start) / cs) + 1;\n\n    if (!isFinite(cs)) {\n      cs = 1;\n      nc = 1;\n    }\n\n    var min0 = start - cs / 2;\n    var max0 = min0 + nc * cs;\n    cVals = [min0, max0];\n  } else {\n    cVals = zOut;\n  }\n\n  Colorscale.calc(gd, trace, {\n    vals: cVals,\n    cLetter: 'z'\n  });\n  return cd;\n};","map":null,"metadata":{},"sourceType":"script"}