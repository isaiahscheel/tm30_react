{"ast":null,"code":"\"use strict\";\n\nvar twoProduct = require(\"two-product\");\n\nvar robustSum = require(\"robust-sum\");\n\nvar robustDiff = require(\"robust-subtract\");\n\nvar robustScale = require(\"robust-scale\");\n\nvar NUM_EXPAND = 6;\n\nfunction cofactor(m, c) {\n  var result = new Array(m.length - 1);\n\n  for (var i = 1; i < m.length; ++i) {\n    var r = result[i - 1] = new Array(m.length - 1);\n\n    for (var j = 0, k = 0; j < m.length; ++j) {\n      if (j === c) {\n        continue;\n      }\n\n      r[k++] = m[i][j];\n    }\n  }\n\n  return result;\n}\n\nfunction matrix(n) {\n  var result = new Array(n);\n\n  for (var i = 0; i < n; ++i) {\n    result[i] = new Array(n);\n\n    for (var j = 0; j < n; ++j) {\n      result[i][j] = [\"m\", j, \"[\", n - i - 2, \"]\"].join(\"\");\n    }\n  }\n\n  return result;\n}\n\nfunction generateSum(expr) {\n  if (expr.length === 1) {\n    return expr[0];\n  } else if (expr.length === 2) {\n    return [\"sum(\", expr[0], \",\", expr[1], \")\"].join(\"\");\n  } else {\n    var m = expr.length >> 1;\n    return [\"sum(\", generateSum(expr.slice(0, m)), \",\", generateSum(expr.slice(m)), \")\"].join(\"\");\n  }\n}\n\nfunction makeProduct(a, b) {\n  if (a.charAt(0) === \"m\") {\n    if (b.charAt(0) === \"w\") {\n      var toks = a.split(\"[\");\n      return [\"w\", b.substr(1), \"m\", toks[0].substr(1)].join(\"\");\n    } else {\n      return [\"prod(\", a, \",\", b, \")\"].join(\"\");\n    }\n  } else {\n    return makeProduct(b, a);\n  }\n}\n\nfunction sign(s) {\n  if (s & 1 !== 0) {\n    return \"-\";\n  }\n\n  return \"\";\n}\n\nfunction determinant(m) {\n  if (m.length === 2) {\n    return [[\"diff(\", makeProduct(m[0][0], m[1][1]), \",\", makeProduct(m[1][0], m[0][1]), \")\"].join(\"\")];\n  } else {\n    var expr = [];\n\n    for (var i = 0; i < m.length; ++i) {\n      expr.push([\"scale(\", generateSum(determinant(cofactor(m, i))), \",\", sign(i), m[0][i], \")\"].join(\"\"));\n    }\n\n    return expr;\n  }\n}\n\nfunction makeSquare(d, n) {\n  var terms = [];\n\n  for (var i = 0; i < n - 2; ++i) {\n    terms.push([\"prod(m\", d, \"[\", i, \"],m\", d, \"[\", i, \"])\"].join(\"\"));\n  }\n\n  return generateSum(terms);\n}\n\nfunction orientation(n) {\n  var pos = [];\n  var neg = [];\n  var m = matrix(n);\n\n  for (var i = 0; i < n; ++i) {\n    m[0][i] = \"1\";\n    m[n - 1][i] = \"w\" + i;\n  }\n\n  for (var i = 0; i < n; ++i) {\n    if ((i & 1) === 0) {\n      pos.push.apply(pos, determinant(cofactor(m, i)));\n    } else {\n      neg.push.apply(neg, determinant(cofactor(m, i)));\n    }\n  }\n\n  var posExpr = generateSum(pos);\n  var negExpr = generateSum(neg);\n  var funcName = \"exactInSphere\" + n;\n  var funcArgs = [];\n\n  for (var i = 0; i < n; ++i) {\n    funcArgs.push(\"m\" + i);\n  }\n\n  var code = [\"function \", funcName, \"(\", funcArgs.join(), \"){\"];\n\n  for (var i = 0; i < n; ++i) {\n    code.push(\"var w\", i, \"=\", makeSquare(i, n), \";\");\n\n    for (var j = 0; j < n; ++j) {\n      if (j !== i) {\n        code.push(\"var w\", i, \"m\", j, \"=scale(w\", i, \",m\", j, \"[0]);\");\n      }\n    }\n  }\n\n  code.push(\"var p=\", posExpr, \",n=\", negExpr, \",d=diff(p,n);return d[d.length-1];}return \", funcName);\n  var proc = new Function(\"sum\", \"diff\", \"prod\", \"scale\", code.join(\"\"));\n  return proc(robustSum, robustDiff, twoProduct, robustScale);\n}\n\nfunction inSphere0() {\n  return 0;\n}\n\nfunction inSphere1() {\n  return 0;\n}\n\nfunction inSphere2() {\n  return 0;\n}\n\nvar CACHED = [inSphere0, inSphere1, inSphere2];\n\nfunction slowInSphere(args) {\n  var proc = CACHED[args.length];\n\n  if (!proc) {\n    proc = CACHED[args.length] = orientation(args.length);\n  }\n\n  return proc.apply(undefined, args);\n}\n\nfunction generateInSphereTest() {\n  while (CACHED.length <= NUM_EXPAND) {\n    CACHED.push(orientation(CACHED.length));\n  }\n\n  var args = [];\n  var procArgs = [\"slow\"];\n\n  for (var i = 0; i <= NUM_EXPAND; ++i) {\n    args.push(\"a\" + i);\n    procArgs.push(\"o\" + i);\n  }\n\n  var code = [\"function testInSphere(\", args.join(), \"){switch(arguments.length){case 0:case 1:return 0;\"];\n\n  for (var i = 2; i <= NUM_EXPAND; ++i) {\n    code.push(\"case \", i, \":return o\", i, \"(\", args.slice(0, i).join(), \");\");\n  }\n\n  code.push(\"}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return testInSphere\");\n  procArgs.push(code.join(\"\"));\n  var proc = Function.apply(undefined, procArgs);\n  module.exports = proc.apply(undefined, [slowInSphere].concat(CACHED));\n\n  for (var i = 0; i <= NUM_EXPAND; ++i) {\n    module.exports[i] = CACHED[i];\n  }\n}\n\ngenerateInSphereTest();","map":null,"metadata":{},"sourceType":"script"}