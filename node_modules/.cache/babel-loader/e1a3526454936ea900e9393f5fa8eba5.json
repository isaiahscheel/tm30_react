{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar d3 = require('d3');\n\nvar getModuleCalcData = require('../../plots/get_data').getModuleCalcData;\n\nvar parcoordsPlot = require('./plot');\n\nvar xmlnsNamespaces = require('../../constants/xmlns_namespaces');\n\nexports.name = 'parcoords';\n\nexports.plot = function (gd) {\n  var calcData = getModuleCalcData(gd.calcdata, 'parcoords')[0];\n  if (calcData.length) parcoordsPlot(gd, calcData);\n};\n\nexports.clean = function (newFullData, newFullLayout, oldFullData, oldFullLayout) {\n  var hadParcoords = oldFullLayout._has && oldFullLayout._has('parcoords');\n\n  var hasParcoords = newFullLayout._has && newFullLayout._has('parcoords');\n\n  if (hadParcoords && !hasParcoords) {\n    oldFullLayout._paperdiv.selectAll('.parcoords').remove();\n\n    oldFullLayout._glimages.selectAll('*').remove();\n  }\n};\n\nexports.toSVG = function (gd) {\n  var imageRoot = gd._fullLayout._glimages;\n  var root = d3.select(gd).selectAll('.svg-container');\n  var canvases = root.filter(function (d, i) {\n    return i === root.size() - 1;\n  }).selectAll('.gl-canvas-context, .gl-canvas-focus');\n\n  function canvasToImage() {\n    var canvas = this;\n    var imageData = canvas.toDataURL('image/png');\n    var image = imageRoot.append('svg:image');\n    image.attr({\n      xmlns: xmlnsNamespaces.svg,\n      'xlink:href': imageData,\n      preserveAspectRatio: 'none',\n      x: 0,\n      y: 0,\n      width: canvas.width,\n      height: canvas.height\n    });\n  }\n\n  canvases.each(canvasToImage); // Chrome / Safari bug workaround - browser apparently loses connection to the defined pattern\n  // Without the workaround, these browsers 'lose' the filter brush styling (color etc.) after a snapshot\n  // on a subsequent interaction.\n  // Firefox works fine without this workaround\n\n  window.setTimeout(function () {\n    d3.selectAll('#filterBarPattern').attr('id', 'filterBarPattern');\n  }, 60);\n};","map":null,"metadata":{},"sourceType":"script"}